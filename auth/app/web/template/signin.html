{{ template "header.html" . }}

<form>
    <div>
        <label class="block" for="email">Email *</label>
        <input id="email" type="email" name="email"
            class="p-2 border shadow-sm text-black border-slate-300 placeholder-slate-400 disabled:bg-slate-50 disabled:text-slate-500 disabled:border-slate-200 focus:outline-none focus:border-indigo-500 focus:ring-indigo-500 block w-full rounded-md sm:text-sm focus:ring-1 invalid:border-pink-500 invalid:text-pink-600 focus:invalid:border-pink-500 focus:invalid:ring-pink-500 disabled:shadow-none"
            placeholder="Email" minlength="6" maxlength="100" required>
    </div>
    <div class="mt-6">
        <label class="block" for="password">Password *</label>
        <input id="password" type="password" name="password"
            class="p-2 border shadow-sm text-black border-slate-300 placeholder-slate-400 disabled:bg-slate-50 disabled:text-slate-500 disabled:border-slate-200 focus:outline-none focus:border-indigo-500 focus:ring-indigo-500 block w-full rounded-md sm:text-sm focus:ring-1 invalid:border-pink-500 invalid:text-pink-600 focus:invalid:border-pink-500 focus:invalid:ring-pink-500 disabled:shadow-none"
            placeholder="Password" minlength="6" maxlength="50" required>
    </div>
    <p id="err" class="my-6 text-red-700"></p>
    <button type="submit"
        class="w-full p-2 bg-indigo-500 text-slate-100 rounded-md flex items-center justify-center min-h-8 h-full">Sign
        in</button>
    <br>
    <div class="flex items-center">
        No account?
        <a href="/signup" class="ml-2 p-2 text-indigo-500 underline">Sign up</a>
    </div>
</form>

{{ template "footer.html" . }}

<script>
    const err = document.getElementById("err");
    const form = document.querySelector("form");

    form.addEventListener("submit", async (event) => {
        event.preventDefault();

        fetch("/signin", {
            method: "POST",
            mode: "same-origin",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
            },
            // referrerPolicy: "same-origin",
            body: new URLSearchParams(new FormData(form)),
        }).then((res) => {
            if (res.redirected) {
                window.location.href = res.url;
                return
            }

            if (!res.ok) {
                res.json().then((data) => {
                    displayError(data.message);
                }).catch(() => {
                    displayError("Something went wrong");
                })
            }
        }).catch((err) => {
            displayError("Something went wrong");
        });
    });

    function displayError(msg) {
        err.textContent = msg;
    }

</script>